# Solana ç¨‹åºéƒ¨ç½²æŒ‡å—

è¿™ä¸ªæ™ºèƒ½éƒ¨ç½²è„šæœ¬å¯ä»¥è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå¹¶å¤„ç†ä¸åŒç½‘ç»œçš„éƒ¨ç½²éœ€æ±‚ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
yarn install
# æˆ–è€…
npm install
```

### 2. åŸºæœ¬éƒ¨ç½²

```bash
# ä½¿ç”¨å½“å‰ solana-cli é…ç½®çš„ç¯å¢ƒéƒ¨ç½²
yarn deploy

# æˆ–è€…ç›´æ¥è¿è¡Œè„šæœ¬
npx ts-node migrations/deploy.ts
```

## ğŸŒ ç¯å¢ƒç‰¹å®šéƒ¨ç½²

### æœ¬åœ°ç¯å¢ƒ (Localnet)
```bash
# è®¾ç½®æœ¬åœ°ç¯å¢ƒå¹¶éƒ¨ç½²
solana config set --url localhost
yarn deploy

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
yarn deploy:local
```

**æœ¬åœ°ç¯å¢ƒç‰¹æ€§:**
- âœ… è‡ªåŠ¨å¯åŠ¨ `solana-test-validator`
- âœ… è‡ªåŠ¨ç­‰å¾…ç½‘ç»œå°±ç»ª  
- âœ… æ”¯æŒéªŒè¯å™¨è¿›ç¨‹ç®¡ç†
- âœ… è‡ªåŠ¨ç©ºæŠ•æµ‹è¯• SOL

### å¼€å‘ç½‘ç»œ (Devnet)
```bash
# è®¾ç½®å¼€å‘ç½‘ç»œå¹¶éƒ¨ç½²
solana config set --url https://api.devnet.solana.com
yarn deploy

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
yarn deploy:devnet
```

### æµ‹è¯•ç½‘ç»œ (Testnet)
```bash
# è®¾ç½®æµ‹è¯•ç½‘ç»œå¹¶éƒ¨ç½²
solana config set --url https://api.testnet.solana.com
yarn deploy

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡  
yarn deploy:testnet
```

### ä¸»ç½‘ (Mainnet)
```bash
# âš ï¸ ä¸»ç½‘éƒ¨ç½²éœ€è¦çœŸå®çš„ SOL
solana config set --url https://api.mainnet-beta.solana.com
yarn deploy

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
yarn deploy:mainnet
```

## ğŸ›  é«˜çº§é€‰é¡¹

### è‡ªåŠ¨æ¸…ç†æ¨¡å¼
```bash
# éƒ¨ç½²å®Œæˆåè‡ªåŠ¨åœæ­¢æœ¬åœ°éªŒè¯å™¨
yarn deploy:auto-cleanup
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# è‡ªåŠ¨æ¸…ç†ï¼ˆé€‚ç”¨äº CI/CDï¼‰
AUTO_CLEANUP=true yarn deploy

# å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šç¯å¢ƒ
SOLANA_ENV=devnet yarn deploy
```

## ğŸ“‹ éƒ¨ç½²æµç¨‹

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **ğŸ” ç¯å¢ƒæ£€æµ‹**
   - è¯»å– `solana config get` è·å–å½“å‰ RPC é…ç½®
   - è¯†åˆ«é›†ç¾¤ç±»å‹ (localnet/devnet/testnet/mainnet)

2. **ğŸš€ éªŒè¯å™¨ç®¡ç†** (ä»…æœ¬åœ°ç¯å¢ƒ)
   - æ£€æŸ¥ `solana-test-validator` æ˜¯å¦è¿è¡Œ
   - å¦‚æœªè¿è¡Œåˆ™è‡ªåŠ¨å¯åŠ¨
   - ç­‰å¾…ç½‘ç»œè¿æ¥å°±ç»ª

3. **ğŸ”¨ ç¨‹åºæ„å»º**
   - æ‰§è¡Œ `anchor build`
   - ç¼–è¯‘ Rust ç¨‹åºä¸º `.so` æ–‡ä»¶

4. **ğŸ“¤ ç¨‹åºéƒ¨ç½²**
   - æ‰§è¡Œ `anchor deploy`
   - ä¸Šä¼ ç¨‹åºåˆ°åŒºå—é“¾
   - è§£æå¹¶æ˜¾ç¤ºç¨‹åº ID

5. **âœ… éƒ¨ç½²éªŒè¯**
   - éªŒè¯ç¨‹åºè´¦æˆ·çŠ¶æ€
   - ç¡®è®¤ç¨‹åºæ­£ç¡®éƒ¨ç½²

## ğŸ¯ è¾“å‡ºç¤ºä¾‹

### æˆåŠŸéƒ¨ç½²
```
ğŸš€ å¼€å§‹ Solana ç¨‹åºéƒ¨ç½²æµç¨‹
==================================================
â¤ æ£€æµ‹ Solana CLI å½“å‰é…ç½®...
â„¹ å½“å‰é›†ç¾¤: localnet (http://localhost:8899)
â„¹ æ£€æµ‹åˆ°æœ¬åœ°ç¯å¢ƒï¼Œå‡†å¤‡å¯åŠ¨æµ‹è¯•éªŒè¯å™¨...
â¤ å¯åŠ¨æœ¬åœ° Solana æµ‹è¯•éªŒè¯å™¨...
âœ“ éªŒè¯å™¨å¯åŠ¨å®Œæˆ
â¤ ç­‰å¾…ç½‘ç»œè¿æ¥å°±ç»ª...
âœ“ ç½‘ç»œè¿æ¥æ­£å¸¸
â¤ æ„å»º Anchor ç¨‹åº...
âœ“ ç¨‹åºæ„å»ºå®Œæˆ
â¤ éƒ¨ç½²ç¨‹åºåˆ°åŒºå—é“¾...
âœ“ ç¨‹åºéƒ¨ç½²æˆåŠŸ! Program ID: CRMKu2kLLiGM18cCtWVgyTzYXyLgdrKxAto1B2CVWNqZ
â¤ éªŒè¯ç¨‹åºéƒ¨ç½²çŠ¶æ€...
âœ“ ç¨‹åºéªŒè¯é€šè¿‡ï¼šå¯æ‰§è¡Œç¨‹åºå·²æ­£ç¡®éƒ¨ç½²
==================================================
âœ“ ğŸ‰ éƒ¨ç½²æˆåŠŸå®Œæˆ! è€—æ—¶: 15.23s

ç¨‹åºä¿¡æ¯:
  é›†ç¾¤: localnet
  Program ID: CRMKu2kLLiGM18cCtWVgyTzYXyLgdrKxAto1B2CVWNqZ
  RPC URL: http://localhost:8899
```

### éƒ¨ç½²å¤±è´¥ç¤ºä¾‹
```
==================================================
âœ— ğŸ’¥ éƒ¨ç½²å¤±è´¥! è€—æ—¶: 5.67s
âœ— é”™è¯¯ä¿¡æ¯: insufficient funds for transaction

æ•…éšœæ’é™¤å»ºè®®:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ RPC é…ç½®
2. ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿçš„ SOL ä½™é¢
3. éªŒè¯ Anchor å’Œ Solana CLI ç‰ˆæœ¬å…¼å®¹æ€§
4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—è·å–æ›´å¤šä¿¡æ¯
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ä½™é¢ä¸è¶³
```
âœ— éƒ¨ç½²å¤±è´¥ï¼šè´¦æˆ·ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆè·å–ä¸€äº› SOL
â„¹ å¯¹äºæœ¬åœ°ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨: solana airdrop 10
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æœ¬åœ°ç¯å¢ƒ
solana airdrop 10

# å¼€å‘ç½‘ç»œ
solana airdrop 2 --url devnet

# æµ‹è¯•ç½‘ç»œ  
solana airdrop 1 --url testnet
```

#### 2. è¿æ¥è¢«æ‹’ç»
```
âœ— éƒ¨ç½²å¤±è´¥ï¼šæ— æ³•è¿æ¥åˆ° Solana ç½‘ç»œ
â„¹ è¯·ç¡®ä¿ solana-test-validator æ­£åœ¨è¿è¡Œ
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ‰‹åŠ¨å¯åŠ¨éªŒè¯å™¨
solana-test-validator --reset

# æ£€æŸ¥éªŒè¯å™¨çŠ¶æ€
solana cluster-version
```

#### 3. ç¨‹åºæ„å»ºå¤±è´¥
```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
anchor clean
anchor build
```

#### 4. ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
```bash
# æ£€æŸ¥ç‰ˆæœ¬
anchor --version
solana --version

# æ›´æ–°å·¥å…·
anchor upgrade
solana-install update
```

### è°ƒè¯•æ¨¡å¼

å¦‚éœ€æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
RUST_LOG=debug yarn deploy

# ä¿ç•™éªŒè¯å™¨æ—¥å¿—
SOLANA_LOG_PATH=./validator.log yarn deploy
```

## ğŸ”’ å®‰å…¨æé†’

### ä¸»ç½‘éƒ¨ç½²æ³¨æ„äº‹é¡¹

âš ï¸ **ä¸»ç½‘éƒ¨ç½²å‰å¿…è¯»:**

1. **é’±åŒ…å®‰å…¨**: ç¡®ä¿ä½¿ç”¨å®‰å…¨çš„é’±åŒ…æ–‡ä»¶
2. **ä»£ç å®¡è®¡**: thoroughly review your program code
3. **å°é¢æµ‹è¯•**: å…ˆç”¨å°‘é‡ SOL æµ‹è¯•éƒ¨ç½²
4. **å¤‡ä»½é‡è¦æ•°æ®**: ä¿å­˜ç¨‹åº ID å’Œå…³é”®ä¿¡æ¯
5. **ç½‘ç»œè´¹ç”¨**: ä¸»ç½‘éƒ¨ç½²éœ€è¦çœŸå®çš„ SOL ä½œä¸ºäº¤æ˜“è´¹

### æ¨èéƒ¨ç½²æµç¨‹

1. **æœ¬åœ°æµ‹è¯•** â†’ `yarn deploy:local`
2. **å¼€å‘ç½‘éªŒè¯** â†’ `yarn deploy:devnet`  
3. **æµ‹è¯•ç½‘éªŒè¯** â†’ `yarn deploy:testnet`
4. **ä¸»ç½‘éƒ¨ç½²** â†’ `yarn deploy:mainnet`

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
solana config get

# åˆ‡æ¢ç½‘ç»œ
solana config set --url <RPC_URL>

# æŸ¥çœ‹é’±åŒ…ä½™é¢
solana balance

# æŸ¥çœ‹ç¨‹åºè´¦æˆ·
solana account <PROGRAM_ID>

# åœæ­¢æœ¬åœ°éªŒè¯å™¨
pkill solana-test-validator
```

## ğŸ¤– CI/CD é›†æˆ

å¯¹äºæŒç»­é›†æˆç¯å¢ƒï¼Œæ¨èä½¿ç”¨è‡ªåŠ¨æ¸…ç†æ¨¡å¼ï¼š

```yaml
# .github/workflows/deploy.yml
- name: Deploy to Devnet
  run: |
    solana config set --url https://api.devnet.solana.com
    AUTO_CLEANUP=true yarn deploy
  env:
    CI: true
```

---

## ğŸ’¡ æç¤º

- è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å¤„ç†ä¸åŒç¯å¢ƒçš„ç‰¹æ®Šéœ€æ±‚
- æœ¬åœ°ç¯å¢ƒä¼šè‡ªåŠ¨ç®¡ç†éªŒè¯å™¨ç”Ÿå‘½å‘¨æœŸ
- æ”¯æŒä¼˜é›…çš„è¿›ç¨‹ä¸­æ–­å’Œæ¸…ç† (Ctrl+C)
- æ‰€æœ‰éƒ¨ç½²ä¿¡æ¯éƒ½ä¼šæ¸…æ™°æ˜¾ç¤ºï¼Œä¾¿äºè°ƒè¯•å’Œè®°å½•